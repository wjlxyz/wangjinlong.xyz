---
title: 《Effective Java》学习笔记——通用程序设计

---





# 将局部变量的作用于最小化

要使局部变量的作用于最小化，最有力的方法就是在第一次使用它的地方声明。

几乎每个局部变量的声明都应该包含一个初始化表达式。

如果在循环终止之后不再需要循环变量的内容，for循环就优先于while循环。

使方法小而集中。如果把两个操作合并到一个方法中，与其中一个操作相关的局部变量就有可能会出现在执行另一个操作的代码范围之内。为了防止这种情况发生，只要把这个方法分成两个，每个方法各执行一个操作。



# for-each循环优先于传统的for循环

当见到冒号（:）时，可以把他读作“在...里面”。因此for-each循环可以读作“对于元素中的每个元素e”。注意，利用for-each循环不会有性能损失，甚至用于数组也一样。实际上，在某些情况下，比起普通的for循环，他还稍有些性能优势，因为他对数组索引的边界值只计算一次。虽然可以手工完成这项工作，但程序员并不总会这么做。
在对多个集合进行嵌套式迭代时，for-each循环相对于传统for循环的这种优势还会更加明显。
for-each循环不仅让你遍历集合和数组，还让你遍历任何实现Iterable接口的对象。
实现Iterable接口并不难。如果你在编写的类型表示的是一组元素，即使你选择不让他实现Collection，也要让他实现Iterable。这样可以允许用户利用for-each循环遍历你的类型，会令用户永远感激不尽的。

总之，for-each循环在简洁性和预防Bug方面有着传统的for循环无法比拟的优势，并且没有性能损失。应该尽可能的使用for-each循环。遗憾的是，有三种常见的情况无法使用for-each循环：

- 过滤——如果需要遍历集合，并删除选定的额元素，就需要使用显式的迭代器，以便可以调用它的remove方法；
- 转换——如果需要遍历列表或者数组，并取代它部分或者全部的元素值，就需要列表迭代器或者数组索引，以便设定元素的值；
- 平行迭代——如果需要并行的遍历多个集合，就需要显式的控制迭代器或者索引变量，以便所有迭代器或者索引变量都可以得到同步前移。



# 了解和使用类库

通过使用标准类库，可以充分利用这些编写标准类库的专家的知识，以及在你之前的其他人的使用经验。

在每个重要的发行版本中，都会有许多新的特性被加入到类库中，所以与这些新特性保持同步是值得的。每个程序员都应该熟悉java.lang、java.util，某种程度上还有java.io中的内容。



# 如果需要精确的答案，请避免使用float和double

float和double主要为了科学计算和工程计算而设计，执行二进制浮点运算，这是为了在广泛的数值范围上提供较为精确的快速近似计算而精心设计的。然而，它们没有提供完全精确的结果，所以不适合用于需要精确结果的场合，尤其是货币计算。

BigDecimal允许完全控制舍入，如果业务要求涉及多种舍入方式，使用BigDecimal很方便，如果性能很关键，涉及的数值不大，就可以使用int或者float，如果数值范围没有超过9位十进制数字，可以使用int，如果不超过18位数字，使用long，如果数值可能超过18位，就必须用BigDecimal。



# 基本类型优先于装箱基本类型

Java 1.5增加自动装箱和自动拆箱，对应基本类型int、double、boolean，装箱基本类型是Integer、Double、Boolean。

基本类型和装箱基本类型之间的三个主要区别：

1. 基本类型只有值，而装箱基本类型具有与它们的值不同的同一性（两个装箱基本类型可以具有相同的值和不同的同一性）
2. 基本类型只有功能完备的值，而每个装箱基本类型除了它对应的基本类型的所有功能值之外，还有个非功能值：null
3. 基本类型通常比装箱基本类型更节省空间和时间。

适合使用装箱基本类型的地方：

1. 作为集合中的元素，键和值；
2. 在参数化类型中，必须使用装箱基本类型作为类型参数；
3. 在进行反射方法调用时，必须使用装箱基本类型。



# 如果其他类型更适合，则尽量避免使用字符串

不应该使用字符串的情形：

1. 字符串不适合代替其他的值类型；
2. 字符串不适合代替枚举类型；
3. 字符串不适合代替聚集类型；
4. 字符串也不适合代替能力表；



# 当心字符串连接的性能

为连接n各字符串而重复地使用字符串连接操作符，需要n的平方级的时间。这是由于字符串不可变而导致的结果。当两个字符串被连接在一起时，它们的内容都要被拷贝。

应该使用StringBuilder的append方法，另一种方法是，使用字符数组，或者每次只处理一个字符串，而不是将它们组合起来。



# 通过接口引用对象

如果有合适的接口类型存在，那么对于参数、返回值、变量和域来说，就都应该使用接口类型进行声明。

如果你养成了用接口作为类型的习惯，你的程序将会更加灵活。当你决定更换实现时，所要做的就只是改变构造器中类的名称（或者使用一个不同的静态工厂）。

如果没有合适的接口存在，完全可以用类而不是接口来引用对象。

如果对象属于这种基于类的框架，就应该用相关的基类来引用这个对象，而不是用它的实现类。



# 接口优先于反射机制

核心反射机制java.lang.reflect，提供了“通过程序来访问关于已装载的类的信息”的能力。



# 谨慎地使用本地方法





# 遵守普遍接受的命名异常